# Configuration

This is done via YAML files. The main file is `config.yml`. Logging behaviour
is configured in `log4rs.yml`. Relevant description is stored in the package's
example logging configuration file.

## `config.yml`

### `store`

See [`store.md`](store.md) for details.

### `rate limit`

Limit the number of failed login attempts of users. You can configure to allow
a maximum of `events` login attempts per `period in seconds`. Any further
attempts will be rejected.

### `web`

All features relating network connectivity and the HTTP protocol.

#### `bind`

The host / IP address and port to which tiny-auth will bind.
E.g. `localhost:8080`.

#### `public host`

Set where tiny-auth is reachable from client perspective.

##### `domain`

The domain under which clients and users can reach tiny-auth. Used for URLs
and cookies.

##### `port`

The domain under which clients and users can reach tiny-auth. Used for URLs.

#### `path`

Optional. The path under which tiny-auth is hosted. If it is deployed on a
subpath below a domain, set the subpath here.

#### `cors`

A list of strings representing approved domains for [Cross Origin Resource
Sharing](https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS). Supported
methods are `GET`, `POST`, and `OPTIONS` and responses are cacheable for 1 day.

#### `static files`

Directory storing the HTML et al. files. This directory is usually determined
by the distribution or package maintainer.

#### `session timeout in seconds`

Optional. Timeout for a single authorization session in seconds. Internally this
is the `Max-Age` of the session cookie. Default value is `3600`.

#### `token timeout in seconds`

Optional. Timeout for OIDC access and id tokens in seconds. Default value is
`60`.

#### `refresh token timeout in seconds`

Optional. Timeout for OIDC refresh tokens in seconds. Default value is `180`.

#### `session same site policy`

Optional. What to set for the session cookie's `SameSite` value. Valid values
are: `none`, `lax`, or `strict`. Default is `lax`.

#### `secret key`

Random string generated by the system administrator. Used to protect the
session cookie.

#### `workers`

Optional. Number of HTTP workers dispatching incoming requests.

#### `tls`

See [`tls.md`](tls.md) for details.

### `api`

Options for the gRPC API used by the web frontend.

#### `endpoint`

Host and port of the API.

### `crypto`

Configuration of cryptographic material used for secure operation.

#### `pepper`

A secret random string generated by the system administrator. It is used to
secure passwords inside the store. Do not change it once you have clients or
users. Otherwise all passwords are invalidated.

#### `key` and `public key`

Paths to a keypair to sign JWT tokens. Supported algorithms are RSA and ECDSA

##### RSA

Use a keysize of at least 4096 bits. Take a look at recent cryptographic
recommendations for a more up-to-date size.

```bash
openssl genrsa 4096 -out key.pem
openssl rsa -in key.pem -pubout -out public_key.pem
```

##### ECDSA

Currently only the curve named in the command is supported.

```bash
openssl ecparam -name secp384r1 -genkey -noout | openssl pkcs8 -topk8 -nocrypt -out key.pem
openssl ec -in key.pem -pubout -out public_key.pem
```
